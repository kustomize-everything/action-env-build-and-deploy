---
name: Testing
on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  test-setup:
    name: Test Setup
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3

      - name: Checkout Testing Repo
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          repository: kustomize-everything/test-deploy
          path: test-deploy

      - name: Action Test with Defaults (diff only)
        uses: ./
        with:
          dry-run: true
          environment: dev
          push-environment-regex: dev
          working-directory: test-deploy

      # TODO Re-create the dry-run test when I've figured out the permissions.
